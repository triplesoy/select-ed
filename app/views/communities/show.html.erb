<% if @community.user == current_user || (current_user && current_user.is_moderator_of?(@community)) || (current_user && current_user.admin) %>
  <div class="container-fluid">
    <div class="card text-white bg-dark shadow mb-1" style="width: 100vw;">
      <div class="card-body text-center">
        <% if current_user.admin %>
          <h5 class="card-title"><strong><span style="color: white;">As a website admin, you can access the dashboard of this community. Do not modify anything without the consent of the community admin</span></strong></h5>
        <% else %>
          <h5 class="card-title"><strong><span style="color: white;">You are the <%= current_user.role_of_this(@community) %> of this community.</span></strong></h5>
        <% end %>
        <%= link_to "Go to the community dashboard", dashboard_path(@community), class: "btn btn-light" %>
        <br>
        <input type="file" accept="image/*" capture="camera">
      </div>
    </div>
  </div>
  <h1><%= @community.title %></h1>
<% else %>
<% end %>
<% if @community.user == current_user || (current_user && current_user.is_moderator_of?(@community)) || (current_user && current_user.admin) %>
  [MEMBER/ADMIN OF THIS COMMUNITY] You do not need to join this community since you are the admin/moderator of it.
<% else %>
  <h1><%= @community.title %></h1>
  <p>
    <%= @community.public? ? 'This community is public' : 'This community is private' %><br>
    <span class="">
      <b>
        <% status = user_community_status(@community, current_user) %>
        <% if status == 'Join' %>
          <%= form_for @join_request, url: community_community_join_requests_path(@community), method: :post do |f| %>
            <%= f.submit status, class: "btn btn-outline-dark" %>
          <% end %>
        <% else %>
          <button class="btn btn-outline-success" disabled><%= status %></button>
        <% end %>
      </b>
    </span>
  </p>
<% end %>
<hr>
<ul>
  <li><%= @community.description %></li>
  <% if @community.photos.attached? %>
    <% @community.photos.each do |photo| %>
      <%= cl_image_tag photo.key, class: "img-thumbnail", width: 200, crop: :thumb %>
    <% end %>
  <% end %>
  <li><%= @community.category %></li>
  <li><%= @community.country %></li>
  <li><%= @community.city %></li>
  <li>Is public? <%= @community.public %></li>
  <li>Is visible? <%= @community.is_visible %></li>
</ul>
<hr>
<h2>Events:</h2>
<% unless @community.public? %>
  <% if @community.user == current_user || (current_user && current_user.is_moderator_of?(@community)) || (current_user && current_user.is_member_of?(@community)) || (current_user.admin?) %>
    <div class="row">
      <% @events.each do |event| %>
        <div class="col-lg-3 my-3">
          <div class="card" style="width: 18rem; height: 22rem;">
            <div class="card-body position-relative">
              <h5 class="card-title"><%= event.title %></h5>
              <h6 class="card-subtitle mb-2 text-muted"></h6>
              <p class="card-text" style="position: absolute; bottom: 0; left: 0; margin: 8px;"><%= event.description %></p>
              <div class="d-flex justify-content-center" style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);">
                <%= event.capacity %>
              </div>
              <%= link_to "Details", community_event_path(@community, event), class: "btn btn-outline-dark position-absolute bottom-0 end-0 m-2" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    You are not allowed to see the events of this community.
  <% end %>
<% else %>
  <div class="row">
    <% @events.each do |event| %>
      <div class="col-lg-3 my-3">
        <div class="card" style="width: 18rem; height: 22rem;">
          <div class="card-body position-relative">
            <h5 class="card-title"><%= event.title %></h5>
            <h6 class="card-subtitle mb-2 text-muted"></h6>
            <p class="card-text" style="position: absolute; bottom: 0; left: 0; margin: 8px;"><%= event.description %></p>
            <div class="d-flex justify-content-center" style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);">
              <%= event.capacity %>
            </div>
            <%= link_to "Details", community_event_path(@community, event), class: "btn btn-outline-dark position-absolute bottom-0 end-0 m-2" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
<% if @community.user == current_user || (current_user && current_user.is_moderator_of?(@community)) || (current_user && current_user.is_member_of?(@community)) || (current_user && current_user.admin?) %>
  <hr>
  <h3>Community settings</h3>
  <ul>
    <% if policy(@community).new? %>
      <li><%= link_to "Create Event", new_community_event_path(@community) %></li>
    <% end %>
    <% if policy(@community).edit? %>
      <li><%= link_to "Edit my community", edit_community_path(@community) %></li>
    <% end %>
    <% if policy(@community).destroy? %>
      <li><%= link_to "Delete my community", community_path(@community), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %></li>
    <% end %>
  <% end %>
</ul>
<hr>
<%= link_to "Back", communities_path %>
