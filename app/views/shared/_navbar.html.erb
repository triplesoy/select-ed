<div class="navbar sticky-top navbar-expand-sm navbar-dark navbar-lewagon" style="">
  <div class="container-fluid" style="">
    <%= link_to(root_path, class: "navbar-brand") do %>
      <%= image_tag("https://res.cloudinary.com/dif8ww5ed/image/upload/v1688144550/nubanubalogov3_jtdked.png", class: "logo logo-align") %>
    <% end %>
    <% if user_signed_in? %>
      <% if current_user&.is_admin_of_any? %>
        <div class="bell-icon col d-flex justify-content-end">
          <ul class="navbar-nav">
            <li class="nav-item">
              <i class="fas fa-solid fa-bell fa-xl me-3" style="color: #fafafa; "></i>
            </li>
          </ul>
        </div>
      <% end %>
    <% end %>
    <button class="pl-3 navbar-toggler end-0 top-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <% if user_signed_in? %>
      <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item" style="white-space: nowrap;">
            <%= link_to my_tickets_path(current_user), class: "nav-link nav-text" do %>
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-ticket-perforated" viewBox="0 0 16 16">
                <path d="M4 4.85v.9h1v-.9H4Zm7 0v.9h1v-.9h-1Zm-7 1.8v.9h1v-.9H4Zm7 0v.9h1v-.9h-1Zm-7 1.8v.9h1v-.9H4Zm7 0v.9h1v-.9h-1Zm-7 1.8v.9h1v-.9H4Zm7 0v.9h1v-.9h-1Z"/>
                <path d="M1.5 3A1.5 1.5 0 0 0 0 4.5V6a.5.5 0 0 0 .5.5 1.5 1.5 0 1 1 0 3 .5.5 0 0 0-.5.5v1.5A1.5 1.5 0 0 0 1.5 13h13a1.5 1.5 0 0 0 1.5-1.5V10a.5.5 0 0 0-.5-.5 1.5 1.5 0 0 1 0-3A.5.5 0 0 0 16 6V4.5A1.5 1.5 0 0 0 14.5 3h-13ZM1 4.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v1.05a2.5 2.5 0 0 0 0 4.9v1.05a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-1.05a2.5 2.5 0 0 0 0-4.9V4.5Z"/>
              </svg>
              my tickets
            <% end %>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle nav-text" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
              </svg>
              <%= current_user.email %>
            </a>
            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
              <% if current_user&.is_admin_of_any? %>
                <a class="dropdown-item nav-text community-dropdown" href="#" role="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                  Owned communities
                </a>
                <div class="collapse community-collapse" id="collapseExample">
                  <% current_user.owned_communities.each do |community| %>
                    <%= link_to community.title, community_path(community), class: "dropdown-item nav-text" %>
                  <% end %>
                </div>
                <hr>
              <% end %>
              <%= link_to "my communities", my_communities_path(current_user), class: "dropdown-item nav-text" %>
              <%= link_to "my events", my_events_path(current_user), class: "dropdown-item nav-text" %>
              <%= link_to "my profile", edit_user_registration_path, class: "dropdown-item nav-text" %>
              <div class="dropdown-divider"></div>
              <%= button_to 'Logout', destroy_user_session_path, class: "dropdown-item nav-text", method: :delete %>
            </div>
          </li>
        </ul>
      </div>
    <% else %>
      <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item">
            <%= link_to "Login", new_user_session_path, class: "nav-link nav-text" %>
          </li>
          <li class="nav-item">
            <%= link_to "Sign up", new_user_registration_path, class: "nav-link nav-text" %>
          </li>
        </ul>
      </div>
    <% end %>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script>
  $(document).ready(function() {
    $('.community-dropdown').click(function(e) {
      e.stopPropagation(); // Prevent the event from propagating up and closing the parent dropdown
      $('.community-collapse').collapse('toggle');
    });

    $('body').on('click', function (e) {
      if (!$('.community-collapse').is(e.target) && $('.community-collapse').has(e.target).length === 0 && $('.show').has(e.target).length === 0) {
          $('.community-collapse').collapse('hide');
      }
    });
  });
</script>
